<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; font-size: 12px; margin: 20px; }
        h2, h3 { text-align: center; }
        table { border-collapse: collapse; width: 100%; margin-top: 10px; }
        th, td { border: 1px solid #000; padding: 5px; text-align: left; }
        .header-table td { border: none; padding: 3px; }
        .section-title { margin-top: 20px; font-weight: bold; font-size: 14px; background-color: #eee; padding: 5px; }
        .summary-box { border: 1px solid #000; padding: 10px; margin-top: 10px; }
    </style>
</head>
<body>
    <h2>Big Apple Taxi - Driver Transaction Receipt</h2>
    <table class="header-table">
        <tr><td><strong>Driver Name:</strong> {{ driver.first_name }} {{ driver.last_name }}</td><td><strong>Hack License:</strong> {{ driver.tlc_license.tlc_license_number }}</td></tr>
        <tr><td><strong>Medallion:</strong> {{ medallion.medallion_number }}</td><td><strong>Cab:</strong> {{ vehicle.registrations[0].plate_number }}</td></tr>
        <tr><td><strong>Date Range:</strong> {{ receipt.period_start }} to {{ receipt.period_end }}</td><td><strong>Generated:</strong> {{ receipt.created_on }}</td></tr>
    </table>

    <div class="section-title">Trip Details</div>
    <table>
        <thead><tr>
            <th>Trip Start Date</th><th>Trip End Date</th><th>Trip ID</th><th>Fare</th><th>Tip</th><th>TIF</th><th>MTA</th><th>CPS</th><th>AAF</th>
        </tr></thead>
        <tbody>
        {% for trip in trips %}
        <tr>
            <td>{{ trip.start_date }} {{ trip.start_time }}</td>
            <td>{{ trip.end_date }} {{ trip.end_time }}</td>
            <td>{{ trip.record_id }} {{ trip.period }}</td>
            <td>{{ trip.trip_amount }}</td><td>{{ trip.tips }}</td>
            <td>{{ trip.distance_service }}</td><td>{{ trip.ehail_fee }}</td>
            <td>{{ trip.congestion_fee }}</td><td>{{ trip.airport_fee }}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

    <div class="section-title">Ledger Entries</div>
    <table>
        <thead><tr><th>ID</th><th>Date</th><th>Category</th><th>Amount</th><th>Type</th><th>Reference</th></tr></thead>
        <tbody>
        {% for entry in ledger_entries %}
        <tr>
            <td>{{ entry.id }}</td><td>{{ entry.created_on }}</td>
            <td>{{ entry.source_type.value }}</td><td>{{ entry.amount }}</td>
            <td>
                {% if entry.debit %}
                    Debit
                {% else %}
                    Credit
                {% endif %}
            </td><td>{{ entry.source_id }}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

    <div class="section-title">Summary</div>
    <div class="summary-box">
        <p><strong>Total Transactions:</strong> {{ entries|length }}</p>
        <p><strong>Total Trips:</strong> {{ trips|length }}</p>
        <p><strong>Returned to Driver:</strong> {{ receipt.balance }}</p>
    </div>

    <div class="section-title">Notes</div>
    <p>Driver signature is required upon collection. Please contact admin for any discrepancies.</p>

</body>
</html>